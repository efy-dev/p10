
<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta charset="UTF-8">
    <title>店铺详情</title>
    <link rel="stylesheet" href="guide/css/layouts.css">
</head>
<body class="detail">

<div class="header" dot-template="header"></div>
<!--//End--header-->

<div dot-template="tenant-base"></div>

<div class="horizontal" style="margin-top: 0;margin-bottom:24px">
    <div class="title"><h2>所有商品</h2></div>
    <div class="swiper-container" dot-template="tenant-product-list">
    </div>
</div>


<div class="horizontal" style="margin-top: 0;margin-bottom:24px">
    <div class="title"><h2>店内实景</h2></div>
    <div class="swiper-container" style="font-size:30px" dot-template="tenant-panel-list">

    </div>
</div>
<div class="footer">
</div>

<script type="text/x-dot-template" id="tenant-base">
    <div class="focus">
        <img src="{{=it.pictureUrl}}@!o2o-home-banner" style="width: 100%" alt="">
    </div>

    {{ if(it.audio!=null) { }}
    <div class="audio audio-box" id="audio">
        <a data-type="audio-button">
            <span class="play active" data-type="audio-icon"><i class="icon"></i></span>
        </a>
        <span class="title">
        <p>{{=it.name}}</p>
        <p>{{=it.name}}的语音介绍</p>
        </span>
        <span class="time"></span>
        <audio id="media" data-type="audio-body" src="{{=it.audio}}" autoplay="autoplay"></audio>
    </div>
    {{ } }}
    <!--//End audio-->

    <div class="info">
        <div class="base">
            <div class="title text_hidden">{{=it.name}}</div>
            {{ if(it.tenantProjectList.length>0){ }}
            <div class="subtitle text_hidden">分类：{{=it.tenantProjectList[0].project.name }}
            </div>
            {{ } }}
            <!--<div class="subtitle text_hidden">主营项目：苏绣手工艺术品</div>-->
            <div class="subtitle text_hidden">地址：<a style="color: #333;" onclick="openLocation({{=it.latitude}},{{=it.longitude}},'{{=it.name}}',14,'')"><span>{{=it.address}}<i class="icon icon_map"></i></span></a></div>
        </div>
        <!--//End base-->
        <div class="praise" dot-template="tenant-praise"></div>
        <!--//End praise-->
        {{
        if(it.tenantMasterList.length!=null &&it.tenantMasterList.length > 0) {
        var master = it.tenantMasterList[0];
        }}
        <div class="master">
            <a href="http://minglu.efeiyi.com/minglu/master/{{=master.master.id}}">
                <div class="img"><img src="http://tenant.efeiyi.com/{{=master.master.favicon}}" alt=""></div>
                <div class="text">
                    <p>{{=master.master.fullName}}</p>
                    <p>{{=master.master.title!=null?master.master.title:"大师简介"}}</p>
                </div>
                <i class="angle right"></i>
            </a>
        </div>

        {{ } }}
        <!--//End master-->
    </div>
</script>

<script type="text/x-dot-template" id="tenant-praise">

    {{ if(PageVariable.currentUser!=null && PageVariable.currentUser.id!=null && PageVariable.currentUser.isPraised==true){ }}
    <a class="btn" onclick="praiseTenant(PageVariable.tenant.id,1)"><i class="icon icon_heart_active"></i><span>{{=it.length}}</span></a>
    {{ }else if(PageVariable.currentUser!=null && PageVariable.currentUser.id!=null){ }}
    <a class="btn" onclick="praiseTenant(PageVariable.tenant.id,0)"><i
            class="icon icon_heart"></i><span>{{=it.length}}</span></a>
    {{ }else { }}
    <a class="btn"><i class="icon icon_heart"></i><span>{{=it.length}}</span></a>
    {{ } }}
    <ul class="ulist">
        {{ for(var i = 0 ; i < it.length ; i++){ }}
        {{
        var user = it[i].user;
        if(user!=null && user.pictureUrl!=null){
        }}
        <li><img src="{{=it[i].user.pictureUrl}}" alt=""></li>
        {{ } else{ }}
        <li><img src="" alt=""></li>
        {{ } }}
        {{ } }}
    </ul>

</script>

<script type="text/x-dot-template" id="tenant-product-list">

    <div class="swiper-wrapper">
        {{

        for (var i = 0 ; i < it.length ; i++) {
        var product = it[i];

        }}
        <div class="swiper-slide">
            <a href="/app/product_details.html?productId={{=product.id}}&title={{=product.product.name}}">
                <img src="{{=product.productModel_url}}@!o2o-tenant-list" alt="">
                <div class="base">
                    <dl class="txt">
                        <dt class="text_hidden">{{=product.product.name}}</dt>
                        <dd class="text_hidden">{{=product.product.subName}}</dd>
                    </dl>
                    <dl class="price">
                        <dt class="text_hidden"> ¥ {{=product.price}}</dt>
                        {{ if(product.marketPrice!=null && product.marketPrice > product.price){ }}
                        <dd class="text_hidden">原价 ¥ 8800</dd>
                        {{ } }}
                    </dl>
                </div>
            </a>
        </div>
        {{ } }}
    </div>

</script>

<script type="text/x-dot-template" id="tenant-panel-list">
    <div class="swiper-wrapper">
        {{ for( var i=0; i < it.length; i++ ){ }}
        <div class="swiper-slide">
            <a href="panel_details.html?panelId={{=it[i].id}}&title={{=it[i].name}}">
                <img src="{{=it[i].imageList[0].image.src}}@!o2o-tenant-list" alt="">
            </a>
        </div>
        {{ } }}
    </div>
</script>

<script src="common/js/common.js"></script>
<script src="common/js/util.js"></script>
<script src="common/js/weixin.js"></script>
<script src="guide/js/controller.js"></script>
<script src="guide/js/model.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<!--//End-->

<script>

    $().ready(function () {
        initPage();
    });

    function initPage() {
        var requestParam = getRequestParameter();
        if (typeof requestParam.title == "undefined") {
            requestParam.title = "";
        }
        PageVariable.tenantId = requestParam.tenantId;
        PageVariable.title = decodeURI(requestParam.title);
        $("title").html(PageVariable.title);
        $("[dot-template=header]").html(renderHeader(PageVariable));

        getTenantById(PageVariable.tenantId, function () {
            wx_share_title = PageVariable.tenant.name;
            wx_share_des = PageVariable.tenant.content;  //分享描述
            var redirect = "http://www.efeiyi.com/qrcode/redirect/tenant/" + PageVariable.tenantId;
            var redirect_uri = "http://mall.efeiyi.com/wx/login.do?redirect=" + redirect;
            wx_share_link = "https://open.weixin.qq.com/connect/oauth2/authorize?" +
                "appid=wx7f6aa253b75466dd" +
                "&redirect_uri=" +
                encodeURI(redirect_uri) +

                "&response_type=code&scope=snsapi_userinfo&state=123#wechat_redirect";
            wx_share_imgUrl = PageVariable.tenant.pictureUrl + "@!o2o-audio-list";
            renderTemplate(PageVariable.template.tenantBase, PageVariable.tenant);
            getTenantPraiseListByTenant(PageVariable.tenantId, function () {
                if (PageVariable.currentUser != null) {
                    PageVariable.currentUser.isPraised = false;
                    for (var i = 0; i < PageVariable.tenantPraiseList.length; i++) {
                        var praise = PageVariable.tenantPraiseList[i];
                        if (praise.user.id == PageVariable.currentUser.id) {
                            PageVariable.currentUser.isPraised = true;
                            break;
                        } else {
                            PageVariable.currentUser.isPraised = false;
                        }
                    }
                }


                renderTemplate(PageVariable.template.tenantPraise, PageVariable.tenantPraiseList);
            });
            $(".audio-box").each(function () {
                PageVariable.audioList.push(new Audio($(this).attr("id")));
                wx.ready(function () {
                    PageVariable.setCurrentAudio(PageVariable.audioList[0]);
                })
            });
        });

        getProductModelList("{\"product.tenant.id\":\"" + PageVariable.tenantId + "\"}", 30, 0, function () {
            renderTemplate(PageVariable.template.tenantProductList, PageVariable.productModelList);
        });

        getImageTextListByTenant(PageVariable.tenantId, function () {
            renderTemplate(PageVariable.template.tenantPanelList, PageVariable.imageTextList);
        })

    }

    function praiseTenant(tenantId, delFlag) {
        saveTenantPraise(tenantId, delFlag, function () {
            getTenantPraiseListByTenant(PageVariable.tenantId, function () {
                if (PageVariable.currentUser != null) {
                    PageVariable.currentUser.isPraised = false;
                    for (var i = 0; i < PageVariable.tenantPraiseList.length; i++) {
                        var praise = PageVariable.tenantPraiseList[i];
                        if (praise.user.id == PageVariable.currentUser.id) {
                            PageVariable.currentUser.isPraised = true;
                            break;
                        } else {
                            PageVariable.currentUser.isPraised = false;
                        }
                    }
                }
                renderTemplate(PageVariable.template.tenantPraise, PageVariable.tenantPraiseList);
            });
        })
    }

</script>


</body>
</html>
